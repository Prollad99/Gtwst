name: Update Links and Deploy

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '14'

      - name: Generate reward.html
        run: |
          if [ ! -f links.json ]; then
            echo "Error: links.json file not found"
            exit 1
          fi
          echo "<html><body>" > reward.html
          jq -r '.[] | "<a href=\"\(.href)\">Gametwist Free Coins</a><br/>"' links.json >> reward.html
          echo "</body></html>" >> reward.html

      - name: Configure Git
        run: |
          git config --global user.email "prolladmail@gmail.com"
          git config --global user.name "Prollad99"

      - name: Commit changes
        run: |
          git add reward.html
          git commit -m "Update reward links"

      - name: Push changes
        env:
          TOKEN: ${{ secrets.ACTIONS_DEPLOY_KEY }}
        run: |
          git push https://${TOKEN}@github.com/Prollad99/Gtwst.git
